
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>15. Decomposition &#8212; Functional Programming in Scala Specialization -- Complied Notes</title>
    
  <link rel="stylesheet" href="../../_static/css/index.73d71520a4ca3b99cfee5594769eaaae.css">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../../_static/sphinx-book-theme.40e2e510f6b7d1648584402491bb10fe.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.3da636dd464baa7582d2.js">

    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script async="async" kind="hypothesis" src="https://hypothes.is/embed.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/sphinx-book-theme.d31b09fe5c1d09cb49b26a786de4a05d.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="16. Pattern Matching" href="week4_6.html" />
    <link rel="prev" title="14. Variance" href="week4_4.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../../index.html">
  
  <img src="../../_static/logo.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">Functional Programming in Scala Specialization -- Complied Notes</h1>
  
</a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../../intro.html">
   Functional Programming in Scala Specialization
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Functional Programming Principles in Scala
 </span>
</p>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../week1/intro.html">
   1. Introduction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../week1/week1_1.html">
   2. Imperative vs Functional Programming
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../week1/week1_2.html">
   3. Expressions and Evaluation model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../week1/week1_3.html">
   4. Tail Recursion
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../week1/week1_4.html">
   5. Exercise Session
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../week2/week2_1.html">
   6. Higher Order Functions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../week2/week2_2.html">
   7. Class and Objects
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../week3/week3_1.html">
   8. Class Hierarchies
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../week3/week3_2.html">
   9. How classes are organized?
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../week3/week3_3.html">
   10. Polymorphism
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="week4_1.html">
   11. Objects Everywhere
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="week4_2.html">
   12. Functions as objects
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="week4_3.html">
   13. Subtyping and Generics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="week4_4.html">
   14. Variance
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   15. Decomposition
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="week4_6.html">
   16. Pattern Matching
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../week5/week5_1.html">
   17. Lists
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../week5/week5_2.html">
   18. Pairs and Tuples
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../week5/week5_3.html">
   19. Higher Order List Functions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../week6/week6_1.html">
   20. Other Collections
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../week6/week6_2.html">
   21. Combinatorial Search and For-Expressions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../week6/week6_3.html">
   22. Combinatorial Search Example
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../week6/week6_4.html">
   23. Maps
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../week6/week6_5.html">
   24. Putting Pieces Together
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Functional Program Design in Scala
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../../fpds/week1/week1_1.html">
   1. Recap Functions and Pattern Matching
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../fpds/week1/week1_2.html">
   2. Recap: Collections
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../fpds/week1/week1_3.html">
   3. Functional Random Generators
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../fpds/week1/week1_4.html">
   4. Monads
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../fpds/week2/week2_1.html">
   5. Streams
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../fpds/week2/week2_2.html">
   6. Case Study: The Water Pouring Problem
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../fpds/week3/week3_1.html">
   7. Type-Directed Programming
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../fpds/week3/week3_2.html">
   8. Type Classes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../fpds/week3/week3_3.html">
   9. Implicit Conversions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../fpds/week4/week4_1.html">
   10. Functions and State
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../fpds/week4/week4_2.html">
   11. Identity and Change
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../fpds/week4/week4_3.html">
   12. Loops
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../fpds/week4/week4_4.html">
   13. Discrete Event Simulation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../fpds/week4/week4_5.html">
   14. Discrete Event Simulation: API and Usage
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../fpds/week4/week4_6.html">
   15. Discrete Event Simulation: Implementation and Test
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../fpds/week5/week5_1.html">
   16. Imperative Event Handling: The Observer Pattern
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../fpds/week5/week5_2.html">
   17. Functional Reactive Programming
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../fpds/week5/week5_3.html">
   18. A Simple FRP Implementation
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Parallel Programming
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../../pp/week1/week1_1.html">
   1. Parallelism on JVM I
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../pp/week1/week1_2.html">
   2. Parallelism on the JVM II
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../pp/week1/week1_3.html">
   3. Running Computations in Parallel
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../pp/week1/week1_4.html">
   4. Running computations in parallel
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../pp/week1/week1_4.html#first-class-tasks">
   5. First Class Tasks
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../pp/week1/week1_4.html#benchmarking-parallel-programs">
   6. Benchmarking Parallel Programs
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../pp/week1/week1_4.html#scalameter">
   7. ScalaMeter
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../pp/week2/week2_1.html">
   8. Parallel Sorting
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../pp/week2/week2_2.html">
   9. Data Operations and Parallel Mapping
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../pp/week2/week2_3.html">
   10. Parallel Fold (Reduce) Operation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../pp/week2/week2_4.html">
   11. Parallel Scan Left
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../pp/week2/week2_5.html">
   12. Assoicativity
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../pp/week3/week3_1.html">
   13. Data-Parallel Programming
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../pp/week3/week3_2.html">
   14. Data-Parallel Operations I
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../pp/week3/week3_2.html#data-parallel-operations-ii">
   15. Data-Parallel Operations II
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../pp/week3/week3_3.html">
   16. Scala Collections Hierarchy
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../pp/week3/week3_4.html">
   17. Splitters and Combiners
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../pp/week4/week4_1.html">
   18. Implementing Combiners
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../pp/week4/week4_2.html">
   19. Parallel Two-phase Construction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../pp/week4/week4_3.html">
   20. Conc-Trees
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../pp/week4/week4_3.html#amortized-constant-time-append-operation">
   21. Amortized, Constant-time Append Operation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../pp/week4/week4_3.html#conc-tree-combiners">
   22. Conc-Tree Combiners
  </a>
 </li>
</ul>

</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/fpps/week4/week4_5.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.md</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

        <!-- Source interaction buttons -->


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#object-oriented-solution">
   15.1. Object-Oriented Solution
  </a>
 </li>
</ul>

        </nav>
        
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="decomposition">
<h1><span class="section-number">15. </span>Decomposition<a class="headerlink" href="#decomposition" title="Permalink to this headline">¶</a></h1>
<p>Let’s say you have a hierarchy of classes and you want to build tree-like data structures from the instances of these classes. How do you build such a tree? And how do you find out what kind of elements are in the tree? And how do you access the data that’s stored in this elements? That’s the problem of decomposition, which we are going to tackle in this session.</p>
<p>Suppose you want to write a small interpreter for arithmetic expressions.</p>
<p>To keep it simple, let’s restrict ourselves to numbers and additions.</p>
<p>Expressions can be represented as a class hierarchy, with a base trait <code class="docutils literal notranslate"><span class="pre">Expr</span></code> and two subclasses, <code class="docutils literal notranslate"><span class="pre">Number</span></code> and <code class="docutils literal notranslate"><span class="pre">Sum</span></code>.</p>
<p>To treat an expression, it’s necessary to know the expression’s shape and its components.</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">trait</span> <span class="nc">Expr</span> <span class="o">{</span>
<span class="k">def</span> <span class="n">isNumber</span><span class="k">:</span> <span class="kt">Boolean</span>
<span class="k">def</span> <span class="n">isSum</span><span class="k">:</span> <span class="kt">Boolean</span>
<span class="k">def</span> <span class="n">numValue</span><span class="k">:</span> <span class="kt">Int</span>
<span class="k">def</span> <span class="n">leftOp</span><span class="k">:</span> <span class="kt">Expr</span>
<span class="k">def</span> <span class="n">rightOp</span><span class="k">:</span> <span class="kt">Expr</span>
<span class="o">}</span>
<span class="k">class</span> <span class="nc">Number</span><span class="o">(</span><span class="n">n</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Expr</span> <span class="o">{</span>
<span class="k">def</span> <span class="n">isNumber</span><span class="k">:</span> <span class="kt">Boolean</span> <span class="o">=</span> <span class="kc">true</span>
<span class="k">def</span> <span class="n">isSum</span><span class="k">:</span> <span class="kt">Boolean</span> <span class="o">=</span> <span class="kc">false</span>
<span class="k">def</span> <span class="n">numValue</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="n">n</span>
<span class="k">def</span> <span class="n">leftOp</span><span class="k">:</span> <span class="kt">Expr</span> <span class="o">=</span> <span class="k">throw</span> <span class="k">new</span> <span class="nc">Error</span><span class="o">(</span><span class="s">&quot;Number.leftOp&quot;</span><span class="o">)</span>
<span class="k">def</span> <span class="n">rightOp</span><span class="k">:</span> <span class="kt">Expr</span> <span class="o">=</span> <span class="k">throw</span> <span class="k">new</span> <span class="nc">Error</span><span class="o">(</span><span class="s">&quot;Number.rightOp&quot;</span><span class="o">)</span>
<span class="o">}</span>
<span class="k">class</span> <span class="nc">Sum</span><span class="o">(</span><span class="n">e1</span><span class="k">:</span> <span class="kt">Expr</span><span class="o">,</span> <span class="n">e2</span><span class="k">:</span> <span class="kt">Expr</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Expr</span> <span class="o">{</span>
<span class="k">def</span> <span class="n">isNumber</span><span class="k">:</span> <span class="kt">Boolean</span> <span class="o">=</span> <span class="kc">false</span>
<span class="k">def</span> <span class="n">isSum</span><span class="k">:</span> <span class="kt">Boolean</span> <span class="o">=</span> <span class="kc">true</span>
<span class="k">def</span> <span class="n">numValue</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="k">throw</span> <span class="k">new</span> <span class="nc">Error</span><span class="o">(</span><span class="s">&quot;Sum.numValue&quot;</span><span class="o">)</span>
<span class="k">def</span> <span class="n">leftOp</span><span class="k">:</span> <span class="kt">Expr</span> <span class="o">=</span> <span class="n">e1</span>
<span class="k">def</span> <span class="n">rightOp</span><span class="k">:</span> <span class="kt">Expr</span> <span class="o">=</span> <span class="n">e2</span>
<span class="o">}</span>
</pre></div>
</div>
<p>You can now write an evaluation function as follows.</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="n">eval</span><span class="o">(</span><span class="n">e</span><span class="k">:</span> <span class="kt">Expr</span><span class="o">)</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="o">{</span>
<span class="k">if</span> <span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="n">isNumber</span><span class="o">)</span> <span class="n">e</span><span class="o">.</span><span class="n">numValue</span>
<span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="n">isSum</span><span class="o">)</span> <span class="n">eval</span><span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="n">leftOp</span><span class="o">)</span> <span class="o">+</span> <span class="n">eval</span><span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="n">rightOp</span><span class="o">)</span>
<span class="k">else</span> <span class="k">throw</span> <span class="k">new</span> <span class="nc">Error</span><span class="o">(</span><span class="s">&quot;Unknown expression&quot;</span> <span class="o">+</span> <span class="n">e</span><span class="o">)</span>
<span class="o">}</span>
</pre></div>
</div>
<p><em>Problem</em>: Writing all these classification and accessor functions quickly becomes tedious!</p>
<p>So, what happens if you want to add new expression forms, say</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Prod</span><span class="o">(</span><span class="n">e1</span><span class="k">:</span> <span class="kt">Expr</span><span class="o">,</span> <span class="n">e2</span><span class="k">:</span> <span class="kt">Expr</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Expr</span> <span class="c1">// e1 * e2</span>
<span class="k">class</span> <span class="nc">Var</span><span class="o">(</span><span class="n">x</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Expr</span> <span class="c1">// Variable ‘x’</span>
</pre></div>
</div>
<p>You need to add methods for classification and access to all classes defined above.</p>
<hr class="docutils" />
<div class="sphinx-bs container pb-4 docutils">
<div class="row docutils">
<div class="d-flex col-lg-12 p-2 docutils">
<div class="card w-100 shadow docutils">
<div class="card-body docutils">
<p class="card-text"><span class="sphinx-bs badge">Exercise</span></p>
<p class="card-text">To integrate <code class="docutils literal notranslate"><span class="pre">Prod</span></code> and <code class="docutils literal notranslate"><span class="pre">Var</span></code> into the hierarchy, how many new method definitions do you need?
(including method definitions in Prod and Var themselves, but not counting methods that were already given.)</p>
</div>
</div>
</div>
</div>
</div>
<details class="sphinx-bs dropdown card mb-3">
<summary class="summary-title card-header">
Solution<div class="summary-down docutils">
<svg version="1.1" width="24" height="24" class="octicon octicon-chevron-down" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M5.22 8.72a.75.75 0 000 1.06l6.25 6.25a.75.75 0 001.06 0l6.25-6.25a.75.75 0 00-1.06-1.06L12 14.44 6.28 8.72a.75.75 0 00-1.06 0z"></path></svg></div>
<div class="summary-up docutils">
<svg version="1.1" width="24" height="24" class="octicon octicon-chevron-up" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M18.78 15.28a.75.75 0 000-1.06l-6.25-6.25a.75.75 0 00-1.06 0l-6.25 6.25a.75.75 0 101.06 1.06L12 9.56l5.72 5.72a.75.75 0 001.06 0z"></path></svg></div>
</summary><div class="summary-content card-body docutils">
<p class="card-text">We need two additional methods in <code class="docutils literal notranslate"><span class="pre">trait</span> <span class="pre">Expr</span></code> <code class="docutils literal notranslate"><span class="pre">def</span> <span class="pre">isProd</span></code> and <code class="docutils literal notranslate"><span class="pre">def</span> <span class="pre">isVar</span></code>. Another operation that gives the name of the variable <code class="docutils literal notranslate"><span class="pre">def</span> <span class="pre">name</span></code> is required. So in total 8 methods for the trait. Each class (<code class="docutils literal notranslate"><span class="pre">Expr</span></code>,<code class="docutils literal notranslate"><span class="pre">Prod</span></code>,<code class="docutils literal notranslate"><span class="pre">Var</span></code>,<code class="docutils literal notranslate"><span class="pre">Sum</span></code>,<code class="docutils literal notranslate"><span class="pre">Number</span></code>) has to implement these methods (8 * 5 = 40). Previously we have 3 classes each have 5 methods, so additionally we implement 25 methods.</p>
</div>
</details><hr class="docutils" />
<p>So generally if we continue to extend the hierarchy, the number of methods need tend to grow quadratically. What to do about it?</p>
<p>Scala let’s you do these using methods defined in class <code class="docutils literal notranslate"><span class="pre">Any</span></code>:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="n">isInstanceOf</span><span class="o">[</span><span class="kt">T</span><span class="o">]</span><span class="k">:</span> <span class="kt">Boolean</span> <span class="c1">// checks whether this object’s type conforms to ‘T‘</span>
<span class="kt">def</span> <span class="kt">asInstanceOf</span><span class="o">[</span><span class="kt">T</span><span class="o">]</span><span class="k">:</span> <span class="kt">T</span> <span class="c1">// treats this object as an instance of type ‘T‘</span>
<span class="c1">// throws ‘ClassCastException‘ if it isn’t.</span>
</pre></div>
</div>
<p>But the use is discouraged in Scala.</p>
<p>Here’s a formulation of the <code class="docutils literal notranslate"><span class="pre">eval</span></code> method using type tests and casts:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="n">eval</span><span class="o">(</span><span class="n">e</span><span class="k">:</span> <span class="kt">Expr</span><span class="o">)</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=</span>
<span class="k">if</span> <span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="n">isInstanceOf</span><span class="o">[</span><span class="kt">Number</span><span class="o">])</span>
<span class="n">e</span><span class="o">.</span><span class="n">asInstanceOf</span><span class="o">[</span><span class="kt">Number</span><span class="o">].</span><span class="n">numValue</span>
<span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="n">isInstanceOf</span><span class="o">[</span><span class="kt">Sum</span><span class="o">])</span>
<span class="n">eval</span><span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="n">asInstanceOf</span><span class="o">[</span><span class="kt">Sum</span><span class="o">].</span><span class="n">leftOp</span><span class="o">)</span> <span class="o">+</span>
<span class="n">eval</span><span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="n">asInstanceOf</span><span class="o">[</span><span class="kt">Sum</span><span class="o">].</span><span class="n">rightOp</span><span class="o">)</span>
<span class="k">else</span> <span class="k">throw</span> <span class="k">new</span> <span class="nc">Error</span><span class="o">(</span><span class="s">&quot;Unknown expression&quot;</span> <span class="o">+</span> <span class="n">e</span><span class="o">)</span>
</pre></div>
</div>
<p>Assessment of this solution:</p>
<ul class="simple">
<li><p>no need for classification methods (like <code class="docutils literal notranslate"><span class="pre">isNumber</span></code>, <code class="docutils literal notranslate"><span class="pre">isSum</span></code> etc.), access methods only for classes where the value is defined.</p></li>
<li><p>low-level and potentially unsafe.</p></li>
</ul>
<p>When you do a typecast, you don’t know at runtime whether the typecast would succeed. It might throw type cast exception.</p>
<div class="section" id="object-oriented-solution">
<h2><span class="section-number">15.1. </span>Object-Oriented Solution<a class="headerlink" href="#object-oriented-solution" title="Permalink to this headline">¶</a></h2>
<p>For example, suppose that all you want to do is evaluate expressions.
You could then define:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">trait</span> <span class="nc">Expr</span> <span class="o">{</span>
<span class="k">def</span> <span class="n">eval</span><span class="k">:</span> <span class="kt">Int</span>
<span class="o">}</span>
<span class="k">class</span> <span class="nc">Number</span><span class="o">(</span><span class="n">n</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Expr</span> <span class="o">{</span>
<span class="k">def</span> <span class="n">eval</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="n">n</span>
<span class="o">}</span>
<span class="k">class</span> <span class="nc">Sum</span><span class="o">(</span><span class="n">e1</span><span class="k">:</span> <span class="kt">Expr</span><span class="o">,</span> <span class="n">e2</span><span class="k">:</span> <span class="kt">Expr</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Expr</span> <span class="o">{</span>
<span class="k">def</span> <span class="n">eval</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="n">e1</span><span class="o">.</span><span class="n">eval</span> <span class="o">+</span> <span class="n">e2</span><span class="o">.</span><span class="n">eval</span>
<span class="o">}</span>
</pre></div>
</div>
<p>But what happens if you’d like to display expressions now? (say new method <code class="docutils literal notranslate"><span class="pre">def</span> <span class="pre">show</span></code> in trait <code class="docutils literal notranslate"><span class="pre">Expr</span></code>) You have to define new methods in all the subclasses. We need to touch all the classes hierarchy, potentially could be thousands (bad idea to touch many code areas!)</p>
<p>And what if you want to simplify the expressions, say using the rule:</p>
<p><code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">*</span> <span class="pre">b</span> <span class="pre">+</span> <span class="pre">a</span> <span class="pre">*</span> <span class="pre">c</span> <span class="pre">-&gt;</span> <span class="pre">a</span> <span class="pre">*</span> <span class="pre">(b</span> <span class="pre">+</span> <span class="pre">c)</span></code></p>
<p><strong>Problem</strong>: This is a non-local simplification. It cannot be encapsulated in the method of a single object. We need to verify the expressions on both side are the same <code class="docutils literal notranslate"><span class="pre">Product</span></code>. So we need accessor methods like <code class="docutils literal notranslate"><span class="pre">def</span> <span class="pre">isProd</span></code>.
You are back to square one; you need test and access methods for all the different subclasses.</p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./fpps/week4"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="week4_4.html" title="previous page"><span class="section-number">14. </span>Variance</a>
    <a class='right-next' id="next-link" href="week4_6.html" title="next page"><span class="section-number">16. </span>Pattern Matching</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Vikram Bhatt<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="../../_static/js/index.3da636dd464baa7582d2.js"></script>


    
  </body>
</html>